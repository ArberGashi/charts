name: ci-qt-swift

on:
  push:
    branches: [ "**" ]
  pull_request:

jobs:
  qt-swift-macos:
    runs-on: macos-latest
    env:
      ARBER_NATIVE_PATH: ${{ secrets.ARBER_NATIVE_PATH }}
    steps:
      - uses: actions/checkout@v4

      - name: Resolve native path
        run: |
          if [ -z "${ARBER_NATIVE_PATH}" ] && [ -d "dist/native" ]; then
            echo "ARBER_NATIVE_PATH=dist/native" >> $GITHUB_ENV
          fi

      - name: Install Qt
        if: env.ARBER_NATIVE_PATH != ''
        run: |
          brew update
          brew install qt@6
          echo "CMAKE_PREFIX_PATH=$(brew --prefix qt@6)" >> $GITHUB_ENV

      - name: Build Qt bridge
        if: env.ARBER_NATIVE_PATH != ''
        run: |
          cmake -S arbercharts-qt-bridge -B arbercharts-qt-bridge/build
          cmake --build arbercharts-qt-bridge/build

      - name: Build Swift bridge
        if: env.ARBER_NATIVE_PATH != ''
        run: |
          cd arbercharts-swift-bridge
          swift build

      - name: Skip notice (no native artifacts)
        if: env.ARBER_NATIVE_PATH == ''
        run: |
          echo "ARBER_NATIVE_PATH not set and dist/native not found; skipping Qt/Swift build."
